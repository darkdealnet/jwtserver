# API версия 1

* [/api/v1/auth/login/](#_1) - авторизация.
* [/api/v1/auth/phone_status/](#_2) - проверка, доступен ли номер.
* [/api/v1/auth/send_code/](#_3) - звонок или смс.
* [/api/v1/auth/check_code/](#_4) - проверка отправленного кода.
* [/api/v1/auth/logout/](#_5) - уничтожение токенов.
* [/api/v1/auth/signup/](#_6) - регистрация пользователя.
* [/api/v1/auth/update_token/](#_7) - регистрация пользователя.

## Авторизация

**POST:** `/api/v1/auth/login/` application/json

Самая важная часть нашего API - это авторизация пользователя, наша задача - получить пару логин и
пароль, вернуть токен доступа и установить refresh_token в cookie.

1. Проверяем [**Recaptcha greenlight**](../recaptcha_v3.md#greenlight)
2. Проверяем пару логин и пароль
3. Создаём пару `access_token` и `refresh_token`
4. Устанавливаем _cookie_ `refresh_token` _httponly secure_

**Response:**

```json
{
  "access_token": "string",
  "token_type": "JSv1"
}
```

Не удивляйтесь, что `token_type` имеет название не `JWT`, а `JSv1` (`JWT Server version 1`).

## Проверка, доступен ли номер

Перед регистрацией пользователя нужно убедиться, что номер телефона для учётной записи свободен

1. Проверяем [**Recaptcha greenlight**](../recaptcha_v3.md#greenlight).
2. Проверяем наличие номера в базе.
3. Проверяем, были ли запросы на [получение кода](#_3).

**Response**

```json
{
  "free": true,
  "telephone": "string",
  "sent": true,
  "time": 0
}
```

## Звонок или смс

Настройки по умолчанию в `config.ini` 

```ini
;не учитывать попытки звонков и смс
ignore_attempts = False

;допустимое количество попыток звонка на конкретный номер
try_call = 2

;допустимое количество отправки СМС на конкретный номер
try_sms = 2

;время блокировки, когда попытки звонков и смс закончатся
block_time_minutes = 180
```

Перед регистрацией пользователя по _номеру телефона_, нужно проверить, является ли пользователь
его владельцем. Поэтому вначале попробуем на него позвонить и если звонок не пройдет, 
то потом мы в отправим на него СМС.

Каждая попытка отправки обновляет время блокировки на 3 часа.

1. Если попыток меньше 2 будет звонок, если больше то СМС
    * Если с последней попытки отправки кода не прошло время блокировки, вернём `Response` с
с параметрами.
    * Если попыток 4 и более `HTTPException`
      
2. Если попыток 4 и более 

**Response**

```json
{
  "send": true,
  "time": 0,
  "method": "string"
}
```